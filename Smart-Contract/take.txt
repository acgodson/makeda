  while (
            highestCoverage > 0 &&
            newTrade.balance > 0 &&
            selectedFulfillerIndex != 0 // Check if there is a valid match
        ) {
            Trade storage existingTrade = trades[selectedFulfillerIndex];
            address selectedFulfiller = existingTrade.initiator;

            // Update the trade states and balances
            updateTradeStates(
                newTrade,
                existingTrade,
                highestCoverage,
                msg.sender
            );

            emit TradeOrderSubmitted(
                tradeCounter,
                msg.sender,
                selectedFulfiller
            );

            // Find the next best match only if there is a remaining balance
            if (newTrade.balance > 0) {
                (highestCoverage, selectedFulfillerIndex) = findBestMatch(
                    tradeCounter,
                    traderToken,
                    counterPartyToken,
                    traderAmount
                );

                // If there are no more matches, break out of the loop
                if (highestCoverage == 0 || selectedFulfillerIndex == 0) {
                    break;
                }
            } else {
                // If the balance is zero, break out of the loop
                break;
            }
        }